#!/bin/bash
###########################################################################################
####                               INSTRUCTIONS SET UP                                 ####
####                                avx, avx2, avx512                                  ####
###########################################################################################
instructions="avx2"

###########################################################################################
####                                 COMPILER SET UP                                   ####
###########################################################################################
fcompile="gfortran-12 -Ofast \
                      -march=native \
                      -mprefer-vector-width=512 \
                      -fno-bounds-check \
                      -flto=auto \
                      -fwhole-program \
                      -fopenmp \
                      -D$instructions \
                      -cpp"

###########################################################################################
####                                  COMPILER FUNCTION                                ####
###########################################################################################
function libfcompile() {
    if [ ! -z "$3" ]
      then
        $fcompile -c $1/$3
    fi
    
    $fcompile -c $1/$2
    $fcompile -c $(find $1/smod/. -type f) &
    wait 
}

###########################################################################################
####                                  CLEANING FUNCTION                                ####
###########################################################################################
function libfclean() {
    rm *.smod *.mod *.o || true
}
