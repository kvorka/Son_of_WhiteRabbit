#!/bin/bash
###########################################################################################
####                                  CODE SETTINGS                                    ####
####                               wallclock, convection                               ####
###########################################################################################
code_type="wallclock"
build_shtns=0

###########################################################################################
####                                     DIRECTORIES                                   ####
###########################################################################################
if [ "$code_type" = "convection" ]; then
    rm -rf data || true
    
    mkdir data
    
    mkdir data/data_ocean_temp
    mkdir data/data_ocean_veloc
    mkdir data/data_ocean_fluxu
    mkdir data/data_ocean_fluxd
fi

###########################################################################################
####                                    COMPILE SHTNS                                  ####
###########################################################################################
source ./shell/shtns.sh $build_shtns
cp shtns/libshtns.a .

###########################################################################################
####                               PREPARING THE COMPILER                              ####
###########################################################################################
source ./shell/compiler.sh

###########################################################################################
####                                  COMPILING KERNELS                                ####
###########################################################################################
libfcompile kernels/math math.f90 calloc.f90
libfcompile kernels/sph/ sph.f90
libfcompile kernels/fft/ fourier_transform.f90
libfcompile kernels/legepoly/ lege_poly.f90
libfcompile kernels/sphsvt/mod/cleb/ cleb.f90
libfcompile kernels/sphsvt/mod/sphbase/ sphbase.f90
libfcompile kernels/sphsvt/ sphsvt.f90
libfcompile kernels/sphsvt2/ sphsvt2.f90
libfcompile kernels/equations/ equations.f90
libfcompile kernels/radgrid/ radial_grid.f90
libfcompile kernels/latgrid/mod/ grid_ops.f90
libfcompile kernels/latgrid/ lateral_grid.f90
libfcompile kernels/latgrid2/ lateral_grid2.f90
libfcompile kernels/object/ physicalobject.f90

###########################################################################################
####                             COMPILING MODEL AND LINKING                           ####
###########################################################################################
libfcompile code/ocean/ ocean.f90 ocean_constants.f90
$fcompile -D$code_type code/codes/BielyKralik.f90 *.o *.a -o "Test_"$code_type".out" -lfftw3 -lm

$fcompile code/codes/Test_shtns.f90 *.o *.a -o Test_shtns.out -lfftw3 -lm

###########################################################################################
####                                       CLEANING                                    ####
###########################################################################################
libfclean
