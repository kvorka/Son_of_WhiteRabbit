#!/bin/bash
###########################################################################################
####                              POSSIBLE CODE SETTINGS                               ####
####                            test_speed, ocean_convection                           ####
###########################################################################################
code_type="test_speed"

###########################################################################################
####                               INSTRUCTIONS SET UP                                 ####
####                                avx, avx2, avx512                                  ####
###########################################################################################
instructions="avx2"

###########################################################################################
####                                 COMPILER SET UP                                   ####
###########################################################################################
source ./kernels/shell/compiler.sh

###########################################################################################
####                             COMPILATION OF THE BASELINE                           ####
###########################################################################################
libfcompile kernels/math/math math.f90
libfcompile kernels/math/sph/ sph.f90
libfcompile kernels/math/fft/ fourier_transform.f90
libfcompile kernels/math/legepoly/ lege_poly.f90
libfcompile kernels/math/sphsvt/mod/ cleb.f90
libfcompile kernels/math/sphsvt/ sphsvt.f90
libfcompile kernels/math/lu_matrix/ matrix.f90
libfcompile kernels/grid/radial/ radial_grid.f90
libfcompile kernels/grid/lateral/mod/ grid_ops.f90
libfcompile kernels/grid/lateral/ lateral_grid.f90
libfcompile kernels/equations/solution/ solution.f90
libfcompile kernels/equations/matrices/ matrices.f90
libfcompile kernels/object/ physicalobject.f90

###########################################################################################
####                            COMPILATION OF THE MODEL                               ####
###########################################################################################
$fcompile -c code/ocean/ocean_constants.f90
libfcompile code/ocean/ ocean.f90

#rm -r -f data || true

###########################################################################################
####                                    LINKING                                        ####
###########################################################################################
case $code_type in

    test_speed)
        
        $fcompile code/codes/BielyKralik_speedTest.f90 *.o -o Test_speed
        
    ;;
    
    ocean_convection)
        mkdir data

        mkdir data/data_ocean_temp
        mkdir data/data_ocean_veloc
        mkdir data/data_ocean_fluxu
        mkdir data/data_ocean_fluxd
        
        $fcompile code/codes/BielyKralik_oceanConv.f90 *.o -o Test_convection
    ;;
    
esac

###########################################################################################
####                                    CLEANING                                       ####
###########################################################################################
rm *.smod *.mod *.o
